
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>logreg_example</title>
      <meta name="generator" content="MATLAB 7.7">
      <meta name="date" content="2011-02-16">
      <meta name="m-file" content="logreg_example"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head>
   <body>
      <div class="content">
         <h2>Contents</h2>
         <div>
            <ul>
               <li><a href="#2">Generate problem data</a></li>
               <li><a href="#3">Solve problem</a></li>
               <li><a href="#4">Reporting</a></li>
            </ul>
         </div><pre class="codeinput"><span class="comment">% L1 regularized logistic regression (not distributed)</span>
</pre><h2>Generate problem data<a name="2"></a></h2><pre class="codeinput">rand(<span class="string">'seed'</span>, 0);
randn(<span class="string">'seed'</span>, 0);

n = 50;
m = 200;

w = sprandn(n, 1, 0.1);  <span class="comment">% N(0,1), 10% sparse</span>
v = randn(1);            <span class="comment">% random intercept</span>

X = sprandn(m, n, 10/n);
btrue = sign(X*w + v);

<span class="comment">% noise is function of problem size use 0.1 for large problem</span>
b = sign(X*w + v + sqrt(0.1)*randn(m,1)); <span class="comment">% labels with noise</span>

A = spdiags(b, 0, m, m) * X;

ratio = sum(b == 1)/(m);
mu = 0.1 * 1/m * norm((1-ratio)*sum(A(b==1,:),1) + ratio*sum(A(b==-1,:),1), <span class="string">'inf'</span>);

x_true = [v; w];
</pre><h2>Solve problem<a name="3"></a></h2><pre class="codeinput">[x history] = logreg(A, b, mu, 1.0, 1.0);
</pre><pre class="codeoutput">iter	    r norm	   eps pri	    s norm	  eps dual	 objective
  1	    3.3583	    0.0489	    2.9421	    0.0343	     31.57
  2	    1.5574	    0.0439	    1.8655	    0.0469	     40.27
  3	    0.9098	    0.0469	    0.8803	    0.0530	     43.50
  4	    0.6102	    0.0489	    0.4102	    0.0573	     44.71
  5	    0.4396	    0.0499	    0.1878	    0.0602	     45.56
  6	    0.3283	    0.0503	    0.0802	    0.0624	     46.12
  7	    0.2521	    0.0504	    0.0318	    0.0641	     46.51
  8	    0.1979	    0.0505	    0.0133	    0.0654	     46.79
  9	    0.1580	    0.0505	    0.0083	    0.0663	     46.99
 10	    0.1201	    0.0505	    0.0220	    0.0671	     47.18
 11	    0.0916	    0.0505	    0.0358	    0.0676	     47.34
 12	    0.0719	    0.0505	    0.0133	    0.0679	     47.42
 13	    0.0575	    0.0505	    0.0060	    0.0683	     47.47
 14	    0.0463	    0.0505	    0.0037	    0.0685	     47.52
Elapsed time is 0.093047 seconds.
</pre><h2>Reporting<a name="4"></a></h2><pre class="codeinput">K = length(history.objval);

h = figure;
plot(1:K, history.objval, <span class="string">'k'</span>, <span class="string">'MarkerSize'</span>, 10, <span class="string">'LineWidth'</span>, 2);
ylabel(<span class="string">'f(x^k) + g(z^k)'</span>); xlabel(<span class="string">'iter (k)'</span>);

g = figure;
subplot(2,1,1);
semilogy(1:K, max(1e-8, history.r_norm), <span class="string">'k'</span>, <span class="keyword">...</span>
    1:K, history.eps_pri, <span class="string">'k--'</span>,  <span class="string">'LineWidth'</span>, 2);
ylabel(<span class="string">'||r||_2'</span>);

subplot(2,1,2);
semilogy(1:K, max(1e-8, history.s_norm), <span class="string">'k'</span>, <span class="keyword">...</span>
    1:K, history.eps_dual, <span class="string">'k--'</span>, <span class="string">'LineWidth'</span>, 2);
ylabel(<span class="string">'||s||_2'</span>); xlabel(<span class="string">'iter (k)'</span>);
</pre><img vspace="5" hspace="5" src="logreg_example_01.png" alt=""> <img vspace="5" hspace="5" src="logreg_example_02.png" alt=""> <p class="footer"><br>
            Published with MATLAB&reg; 7.7<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####
% L1 regularized logistic regression (not distributed)

%% Generate problem data

rand('seed', 0);
randn('seed', 0);

n = 50; 
m = 200;

w = sprandn(n, 1, 0.1);  % N(0,1), 10% sparse
v = randn(1);            % random intercept

X = sprandn(m, n, 10/n);
btrue = sign(X*w + v);

% noise is function of problem size use 0.1 for large problem
b = sign(X*w + v + sqrt(0.1)*randn(m,1)); % labels with noise

A = spdiags(b, 0, m, m) * X;

ratio = sum(b == 1)/(m);
mu = 0.1 * 1/m * norm((1-ratio)*sum(A(b==1,:),1) + ratio*sum(A(b==-1,:),1), 'inf');

x_true = [v; w];

%% Solve problem

[x history] = logreg(A, b, mu, 1.0, 1.0);

%% Reporting

K = length(history.objval);                                                                                                        

h = figure;
plot(1:K, history.objval, 'k', 'MarkerSize', 10, 'LineWidth', 2); 
ylabel('f(x^k) + g(z^k)'); xlabel('iter (k)');

g = figure;
subplot(2,1,1);                                                                                                                    
semilogy(1:K, max(1e-8, history.r_norm), 'k', ...
    1:K, history.eps_pri, 'kREPLACE_WITH_DASH_DASH',  'LineWidth', 2); 
ylabel('||r||_2'); 

subplot(2,1,2);                                                                                                                    
semilogy(1:K, max(1e-8, history.s_norm), 'k', ...
    1:K, history.eps_dual, 'kREPLACE_WITH_DASH_DASH', 'LineWidth', 2);   
ylabel('||s||_2'); xlabel('iter (k)'); 

##### SOURCE END #####
-->
   </body>
</html>